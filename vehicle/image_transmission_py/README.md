# Программное обеспечение для клиент-серверной передачи кадров

## Описание классов

### iqr_camera.py - класс описывающий камеру

Файл содержит класс IQRCamera.
При создании экземпляра можно задать порт камеры и желаемые ширину и высоту кадра.
Класс имеет всего один открытый метод - **get_frame(nTries)**
Этот метод делает следующее:

1. Открытие устройства
2. Установка параметров высоты и ширины кадра (если заданы)
3. Получение кадра
4. Закрытие устройства
5. Возвращение полученного ранее кадра в качестве результата

### iqr_image_server.py

Файл содержит класс ImageServer.
Конструктор:

```Python
ImageServer(addr, port, camera:IQRCamera)
```

*addr* - адрес для прослушивания
*port* - порт который будет прослушиваться
*camera* - объект камеры с которого будет получаться кадр

Класс имеет два метода:

* **start()** - запускает сервер. Метод блокирует поток.
* **stop()** - останавливает сервер. Закрывает сокет и прекращает бесконечный цыкл прослушивания. Метод должен вызываться из другого потока.

Работа сервера представляет собой бесконечный цикл из следующей последовательности действий:

1. Подключение клиента
2. Получение кадра с камеры
3. Сжатие кадра с помощью кодека '.JPG' (функция библиотеки OpenCV `imencode`)
4. Вычисление размера сжатого изображения
5. Формирование сообщения для передачи (размер_кадра + сжатый_кадр)
6. Отправка сообщения через сокет
7. Закрытие подключения

### iqr_image_client.py

Файл содержит класс ImageClient.
Конструктор:

```Python
ImageClient(addr, port)
```

*addr* - адрес сервера
*port* - порт сервера

Класс имеет один метод:

* **get_frame()** - осуществляет подключение к серверу и возвращает полученный кадр.

Функция выполняет следующие действия:

1. Подключение к серверу
2. Получение размера сообщение
3. Получение оставшейся части сообщения
4. Отключение от сервера
5. Декодировка (распаковка) кадра
6. Возвращение результата

### Описание структуры сообщения

Структура сообщения:
( 4 байта - размер сжатого кадра | N байт - сжатый кадр )

В начале сообщения идёт размер сжатого кадра - число типа int (4 байта), последовательность битов - big indian.
Далее идёт сам сжатый кадр.

## Описание программ для тестирования

### test_client.py

Программа осуществляет однократное подключение к указанному в коде адресу, получает кадр и отображает его в окне средствами OpenCV. Для закрытия окна нажмите любую клавишу.

### test_server.py

Программа определяет IP адрес компьютера, на котором запущена.
Создаётся объект камеры без указания размеров кадра и со стандартным номером устройства "0".
Затем создаётся объект сервера с полученным ранее адресом и объектом камеры.
Далее вызывается метод **start()**. 
Для завершения программы нажмите Ctrl+C в консоли.